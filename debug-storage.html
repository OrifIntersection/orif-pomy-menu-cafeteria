<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8"/>
  <title>Debug Storage - ORIF</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 2rem; }
    .debug-section { margin: 2rem 0; padding: 1rem; border: 1px solid #ddd; border-radius: 6px; }
    .debug-data { background: #f5f5f5; padding: 1rem; white-space: pre-wrap; font-family: monospace; }
    .btn { padding: 0.5rem 1rem; margin: 0.5rem; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
  </style>
</head>
<body>
  <h1>Diagnostic localStorage ORIF</h1>
  
  <div class="debug-section">
    <h2>Menu Data</h2>
    <div id="menu-data" class="debug-data">Chargement...</div>
    <button class="btn" onclick="testerEnregistrement()">Test Enregistrement</button>
    <button class="btn" onclick="viderTout()">Vider tout</button>
  </div>
  
  <div class="debug-section">
    <h2>Menu History</h2>
    <div id="history-data" class="debug-data">Chargement...</div>
  </div>
  
  <div class="debug-section">
    <h2>Chef Info</h2>
    <div id="chef-data" class="debug-data">Chargement...</div>
  </div>

  <div class="debug-section">
    <h2>Test rapide</h2>
    <button class="btn" onclick="ajouterMenuTest()">Ajouter Menu Test</button>
    <button class="btn" onclick="ajouterChefTest()">Ajouter Chef Test</button>
    <a href="index.html" class="btn">Voir Page Principale</a>
  </div>

  <script>
    function afficherDonnees() {
      document.getElementById('menu-data').textContent = 
        localStorage.getItem('orif_menu_data') || 'Aucune donnée';
      document.getElementById('history-data').textContent = 
        localStorage.getItem('orif_menu_history') || 'Aucune donnée';
      document.getElementById('chef-data').textContent = 
        localStorage.getItem('orif_chef_info') || 'Aucune donnée';
    }

    function testerEnregistrement() {
      console.log('Test enregistrement démarré');
      
      // Créer un menu test
      const menuTest = {
        today: {
          date: "2025-08-12",
          plat: {
            name: "TEST Menu",
            description: "Menu de test pour diagnostic",
            img: "plat_jour.jpg",
            veg: false,
            allergens: ["test"]
          },
          dessert: { text: "Dessert test", allergens: [] },
          self: ["Item 1", "Item 2"],
          saladbar: ["Salade 1"],
          vegetarien: "Plat végé test",
          avis: []
        }
      };

      const historyTest = [{
        id: Date.now(),
        date: "2025-08-12",
        platName: "TEST Menu",
        platDesc: "Menu de test pour diagnostic",
        platImg: "plat_jour.jpg",
        platVeg: false,
        platAllergens: ["test"],
        dessertText: "Dessert test",
        dessertAllergens: [],
        selfItems: ["Item 1", "Item 2"],
        saladItems: ["Salade 1"],
        vegText: "Plat végé test",
        timestamp: new Date().toISOString()
      }];

      try {
        localStorage.setItem('orif_menu_data', JSON.stringify(menuTest));
        localStorage.setItem('orif_menu_history', JSON.stringify(historyTest));
        console.log('✅ Données enregistrées avec succès');
        alert('Test d\'enregistrement réussi !');
        afficherDonnees();
      } catch (e) {
        console.error('❌ Erreur enregistrement:', e);
        alert('Erreur: ' + e.message);
      }
    }

    function ajouterMenuTest() {
      const menuExistant = JSON.parse(localStorage.getItem('orif_menu_data') || '{}');
      const historyExistant = JSON.parse(localStorage.getItem('orif_menu_history') || '[]');
      
      const nouveauMenu = {
        today: {
          date: new Date().toISOString().slice(0, 10),
          plat: {
            name: "Coq au Vin Express",
            description: "Poulet fermier mijoté rapidement",
            img: "attached_assets/generated_images/coq_au_vin_dish.png",
            veg: false,
            allergens: ["sulfites"]
          },
          dessert: { text: "Tarte express", allergens: ["gluten"] },
          self: ["Plat 1", "Plat 2", "Plat 3"],
          saladbar: ["Salade verte", "Tomates"],
          vegetarien: "Légumes express",
          avis: []
        }
      };

      const nouvelHistoire = {
        id: Date.now(),
        date: new Date().toISOString().slice(0, 10),
        platName: "Coq au Vin Express",
        platDesc: "Poulet fermier mijoté rapidement",
        platImg: "attached_assets/generated_images/coq_au_vin_dish.png",
        platVeg: false,
        platAllergens: ["sulfites"],
        dessertText: "Tarte express",
        dessertAllergens: ["gluten"],
        selfItems: ["Plat 1", "Plat 2", "Plat 3"],
        saladItems: ["Salade verte", "Tomates"],
        vegText: "Légumes express",
        timestamp: new Date().toISOString()
      };

      localStorage.setItem('orif_menu_data', JSON.stringify(nouveauMenu));
      historyExistant.push(nouvelHistoire);
      localStorage.setItem('orif_menu_history', JSON.stringify(historyExistant));
      
      alert('Menu test ajouté ! Va voir la page principale.');
      afficherDonnees();
    }

    function ajouterChefTest() {
      const chefTest = {
        nom: "Chef Marco Dupont",
        description: "Chef expérimenté spécialisé dans la cuisine française moderne. Expert en produits locaux.",
        photo: "Philippe_Etchebest.jpg"
      };
      
      localStorage.setItem('orif_chef_info', JSON.stringify(chefTest));
      alert('Chef test ajouté !');
      afficherDonnees();
    }

    function viderTout() {
      if (confirm('Vider tout le localStorage ?')) {
        localStorage.clear();
        afficherDonnees();
        alert('Tout vidé !');
      }
    }

    // Charger au démarrage
    document.addEventListener('DOMContentLoaded', afficherDonnees);

    // Recharger toutes les 2 secondes
    setInterval(afficherDonnees, 2000);
  </script>
</body>
</html>