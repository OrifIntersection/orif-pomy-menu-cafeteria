<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8"/>
  <title>Test Authentification - ORIF</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 2rem; max-width: 800px; margin: 0 auto; }
    .test-section { margin: 2rem 0; padding: 1.5rem; border: 2px solid #ddd; border-radius: 8px; }
    .test-section h2 { margin-top: 0; color: #2b5a87; }
    .btn { padding: 0.75rem 1.5rem; margin: 0.5rem; background: #007bff; color: white; border: none; border-radius: 6px; cursor: pointer; text-decoration: none; display: inline-block; }
    .btn-success { background: #28a745; }
    .btn-danger { background: #dc3545; }
    .btn-warning { background: #ffc107; color: #212529; }
    .status { padding: 1rem; margin: 1rem 0; border-radius: 6px; font-weight: bold; }
    .status.success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
    .status.error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    .status.info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
    .user-info { background: #f8f9fa; padding: 1rem; border-radius: 6px; margin: 1rem 0; }
    pre { background: #f5f5f5; padding: 1rem; border-radius: 4px; overflow-x: auto; font-size: 0.9rem; }
  </style>
</head>
<body>
  <h1>🔐 Test Système d'Authentification ORIF</h1>
  
  <div id="status-current" class="status info">
    Statut : Vérification en cours...
  </div>

  <div class="test-section">
    <h2>Connexion Rapide</h2>
    <p>Utilise ces boutons pour te connecter rapidement :</p>
    <button class="btn btn-success" onclick="connecterAdmin()">🔧 Connexion Admin</button>
    <button class="btn btn-warning" onclick="connecterMember()">👤 Connexion Member</button>
    <button class="btn btn-danger" onclick="deconnecter()">🚪 Déconnexion</button>
  </div>

  <div class="test-section">
    <h2>État Utilisateur Actuel</h2>
    <div id="user-status" class="user-info">
      Chargement des informations utilisateur...
    </div>
  </div>

  <div class="test-section">
    <h2>Tests de Navigation</h2>
    <p>Une fois connecté, teste ces pages :</p>
    <a href="admin.html" class="btn">📝 Page Admin</a>
    <a href="index.html" class="btn">🏠 Page Principale</a>
    <a href="archive.html" class="btn">📚 Archives</a>
    <a href="login.html" class="btn">🔐 Page Login</a>
  </div>

  <div class="test-section">
    <h2>Données localStorage</h2>
    <h3>Utilisateur connecté :</h3>
    <pre id="current-user-data">Chargement...</pre>
    <h3>Tous les utilisateurs :</h3>
    <pre id="all-users-data">Chargement...</pre>
    
    <div style="margin-top: 1rem;">
      <button class="btn" onclick="rafraichirDonnees()">🔄 Rafraîchir</button>
      <button class="btn btn-danger" onclick="resetAuth()">⚠️ Reset Auth</button>
    </div>
  </div>

  <div class="test-section">
    <h2>Créer Comptes Test</h2>
    <p>Si les comptes n'existent pas, crée-les :</p>
    <button class="btn" onclick="creerComptesTest()">➕ Créer Comptes Admin/Member</button>
  </div>

  <script src="assets/app.js"></script>
  <script>
    function connecterAdmin() {
      const adminUser = {
        email: "ayesh.admin@orif.ch",
        role: "admin",
        nom: "Administrateur",
        timestamp: new Date().toISOString()
      };
      
      localStorage.setItem('orif_current_user', JSON.stringify(adminUser));
      console.log('✅ Connexion admin effectuée');
      mettreAJourStatut();
      alert('✅ Connecté comme Admin !\nTu peux maintenant aller sur admin.html');
    }

    function connecterMember() {
      const memberUser = {
        email: "ayesh.benef@orif.ch", 
        role: "member",
        nom: "Membre Bénéficiaire",
        timestamp: new Date().toISOString()
      };
      
      localStorage.setItem('orif_current_user', JSON.stringify(memberUser));
      console.log('✅ Connexion member effectuée');
      mettreAJourStatut();
      alert('✅ Connecté comme Member !\nTu peux maintenant donner des avis sur les menus');
    }

    function deconnecter() {
      localStorage.removeItem('orif_current_user');
      console.log('🚪 Déconnexion effectuée');
      mettreAJourStatut();
      alert('🚪 Déconnecté !');
    }

    function creerComptesTest() {
      const users = JSON.parse(localStorage.getItem('orif_users') || '[]');
      
      const adminExists = users.find(u => u.email === "ayesh.admin@orif.ch");
      const memberExists = users.find(u => u.email === "ayesh.benef@orif.ch");
      
      if (!adminExists) {
        users.push({
          email: "ayesh.admin@orif.ch",
          password: "0000", 
          role: "admin",
          nom: "Administrateur ORIF"
        });
      }
      
      if (!memberExists) {
        users.push({
          email: "ayesh.benef@orif.ch",
          password: "0000",
          role: "member", 
          nom: "Membre Bénéficiaire"
        });
      }
      
      localStorage.setItem('orif_users', JSON.stringify(users));
      console.log('✅ Comptes test créés');
      rafraichirDonnees();
      alert('✅ Comptes Admin/Member créés avec mot de passe "0000"');
    }

    function resetAuth() {
      if (confirm('⚠️ Supprimer toutes les données d\'authentification ?')) {
        localStorage.removeItem('orif_current_user');
        localStorage.removeItem('orif_users');
        console.log('🗑️ Reset auth effectué');
        mettreAJourStatut();
        alert('🗑️ Authentification réinitialisée !');
      }
    }

    function mettreAJourStatut() {
      const currentUser = JSON.parse(localStorage.getItem('orif_current_user') || 'null');
      const statusDiv = document.getElementById('status-current');
      const userDiv = document.getElementById('user-status');
      
      if (currentUser) {
        statusDiv.className = 'status success';
        statusDiv.innerHTML = '✅ Connecté comme ' + currentUser.role.toUpperCase() + ' : ' + currentUser.email;
        
        userDiv.innerHTML = '<strong>👤 Utilisateur Connecté</strong><br>' +
          '<strong>Email :</strong> ' + currentUser.email + '<br>' +
          '<strong>Rôle :</strong> ' + currentUser.role + '<br>' +
          '<strong>Nom :</strong> ' + currentUser.nom + '<br>' +
          '<strong>Connecté le :</strong> ' + new Date(currentUser.timestamp).toLocaleString('fr-FR');
      } else {
        statusDiv.className = 'status error';
        statusDiv.innerHTML = '❌ Aucun utilisateur connecté';
        
        userDiv.innerHTML = '<em>Aucun utilisateur connecté. Utilise les boutons ci-dessus pour te connecter.</em>';
      }
      
      rafraichirDonnees();
    }

    function rafraichirDonnees() {
      const currentUser = localStorage.getItem('orif_current_user');
      const allUsers = localStorage.getItem('orif_users');
      
      document.getElementById('current-user-data').textContent = 
        currentUser ? JSON.stringify(JSON.parse(currentUser), null, 2) : 'Aucun utilisateur connecté';
      
      document.getElementById('all-users-data').textContent = 
        allUsers ? JSON.stringify(JSON.parse(allUsers), null, 2) : 'Aucun utilisateur enregistré';
    }

    // Initialisation
    document.addEventListener('DOMContentLoaded', () => {
      mettreAJourStatut();
      
      // Vérifier si les fonctions app.js sont disponibles
      setTimeout(() => {
        if (typeof currentUser === 'function') {
          console.log('✅ app.js chargé, fonctions disponibles');
        } else {
          console.log('⚠️ app.js non chargé ou fonctions non disponibles');
        }
      }, 1000);
    });

    // Rafraîchir automatiquement toutes les 3 secondes
    setInterval(mettreAJourStatut, 3000);
  </script>
  
  <footer style="background: #2c3e50; color: white; text-align: center; padding: 2rem 1rem 1rem; margin-top: 2rem;">
    <p style="margin: 0 0 1rem 0; color: white;">© 2025 ORIF – Tous droits réservés</p>
    <div class="footer-links" style="display: flex; justify-content: center; gap: 2rem; flex-wrap: wrap;">
      <a href="#" style="color: #bdc3c7; text-decoration: none; font-size: 0.9rem;">Mentions légales</a>
      <a href="#" style="color: #bdc3c7; text-decoration: none; font-size: 0.9rem;">Conditions d'utilisation</a>
      <a href="#" style="color: #bdc3c7; text-decoration: none; font-size: 0.9rem;">Politique de confidentialité</a>
      <a href="#" style="color: #bdc3c7; text-decoration: none; font-size: 0.9rem;">Accessibilité</a>
    </div>
  </footer>
</body>
</html>