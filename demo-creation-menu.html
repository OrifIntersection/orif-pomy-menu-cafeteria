<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D√©monstration - Cr√©ation Menu</title>
    <link rel="stylesheet" href="assets/style.css"/>
    <link rel="stylesheet" href="assets/responsive.css"/>
    <link rel="stylesheet" href="fixes.css"/>
    <style>
        .demo-container {
            max-width: 800px;
            margin: 2rem auto;
            padding: 2rem;
        }
        .step {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1rem 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .step h3 {
            color: #2c5aa0;
            margin-top: 0;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            padding: 1rem;
            border-radius: 6px;
            margin: 1rem 0;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            padding: 1rem;
            border-radius: 6px;
            margin: 1rem 0;
        }
        .btn {
            background: #2c5aa0;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            margin: 0.5rem;
            font-size: 16px;
        }
        .btn:hover {
            background: #1e3d6f;
        }
        .menu-preview {
            background: #f8f9fa;
            border: 1px solid #ddd;
            padding: 1rem;
            border-radius: 6px;
            margin: 1rem 0;
        }
        .log-output {
            background: #2d3748;
            color: #e2e8f0;
            padding: 1rem;
            border-radius: 6px;
            font-family: monospace;
            font-size: 14px;
            max-height: 300px;
            overflow-y: auto;
            margin: 1rem 0;
        }
    </style>
</head>
<body>
    <header>
        <div class="logo-container">
            <img src="public/images/logo-orif.png" alt="Logo ORIF" class="logo">
            <div>
                <h1>D√©monstration - Cr√©ation de Menu</h1>
            </div>
        </div>
        <div class="user-options">
            <a href="index.html" class="btn">üè† Page d'accueil</a>
            <div id="account-area"></div>
        </div>
    </header>

    <div class="demo-container">
        <div class="step">
            <h3>√âtape 1 : Connexion Administrateur</h3>
            <p>Connexion en tant qu'administrateur pour cr√©er un menu.</p>
            <button class="btn" onclick="etape1ConnexionAdmin()">Se connecter comme Admin</button>
            <div id="result-step1"></div>
        </div>

        <div class="step">
            <h3>√âtape 2 : Cr√©ation du Menu pour Demain</h3>
            <p>Cr√©ation d'un menu complet pour le <strong id="date-demain"></strong></p>
            <button class="btn" onclick="etape2CreerMenu()" id="btn-creer-menu" disabled>Cr√©er Menu de Demain</button>
            <div id="result-step2"></div>
        </div>

        <div class="step">
            <h3>√âtape 3 : V√©rification de l'Enregistrement</h3>
            <p>V√©rification que le menu a √©t√© correctement enregistr√© dans le syst√®me.</p>
            <button class="btn" onclick="etape3Verification()" id="btn-verif" disabled>V√©rifier l'Enregistrement</button>
            <div id="result-step3"></div>
        </div>

        <div class="step">
            <h3>√âtape 4 : Test Utilisateur Final</h3>
            <p>Test en tant que b√©n√©ficiaire pour voir le menu et ajouter un avis.</p>
            <button class="btn" onclick="etape4TestBeneficiaire()" id="btn-test-benef" disabled>Tester comme B√©n√©ficiaire</button>
            <div id="result-step4"></div>
        </div>

        <div class="step">
            <h3>Logs en Temps R√©el</h3>
            <div class="log-output" id="logs"></div>
            <button class="btn" onclick="clearLogs()" style="background: #6c757d;">Effacer Logs</button>
        </div>
    </div>

    <script src="assets/app.js"></script>
    <script src="admin.js"></script>
    <script src="member.js"></script>
    <script>
        let logDiv;
        
        document.addEventListener('DOMContentLoaded', function() {
            logDiv = document.getElementById('logs');
            renderAccountArea();
            
            // Afficher la date de demain
            const demain = new Date();
            demain.setDate(demain.getDate() + 1);
            document.getElementById('date-demain').textContent = demain.toLocaleDateString('fr-FR', {
                weekday: 'long',
                year: 'numeric', 
                month: 'long', 
                day: 'numeric'
            });
            
            log("=== SYST√àME PR√äT POUR LA D√âMONSTRATION ===");
            log("Date cible: " + demain.toISOString().slice(0, 10));
        });

        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML += `[${timestamp}] ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }

        function clearLogs() {
            logDiv.innerHTML = '';
        }

        function etape1ConnexionAdmin() {
            log("=== √âTAPE 1: CONNEXION ADMIN ===");
            
            try {
                const result = login("ayesh.admin@orif.ch", "0000");
                const resultDiv = document.getElementById('result-step1');
                
                if (result) {
                    resultDiv.innerHTML = '<div class="success">‚úÖ Connexion admin r√©ussie<br>Utilisateur: ' + result.name + ' (R√¥le: ' + result.role + ')</div>';
                    log("Connexion admin r√©ussie: " + result.name);
                    
                    // Activer l'√©tape suivante
                    document.getElementById('btn-creer-menu').disabled = false;
                    
                    // Mettre √† jour l'affichage du compte
                    renderAccountArea();
                    
                } else {
                    resultDiv.innerHTML = '<div class="error">‚ùå √âchec de la connexion admin</div>';
                    log("ERREUR: √âchec connexion admin");
                }
            } catch (e) {
                log("ERREUR √©tape 1: " + e.message);
                document.getElementById('result-step1').innerHTML = '<div class="error">‚ùå Erreur: ' + e.message + '</div>';
            }
        }

        function etape2CreerMenu() {
            log("=== √âTAPE 2: CR√âATION MENU DEMAIN ===");
            
            const user = currentUser();
            if (!user || user.role !== 'admin') {
                log("ERREUR: Utilisateur non admin");
                return;
            }

            try {
                // Date de demain
                const demain = new Date();
                demain.setDate(demain.getDate() + 1);
                const dateString = demain.toISOString().slice(0, 10);
                
                log("Cr√©ation menu pour: " + dateString);

                // Donn√©es du menu de test
                const menuTest = {
                    today: {
                        date: dateString,
                        platName: "Coq au Vin de Demain",
                        platDesc: "Coq au vin traditionnel avec pommes de terre r√¥ties et l√©gumes de saison",
                        platImg: "plat_jour.jpg",
                        platVeg: false,
                        platAllergens: ["sulfites", "lactose"],
                        dessertText: "Tarte aux pommes maison",
                        dessertAllergens: ["gluten", "lactose", "oeufs"],
                        selfItems: [
                            { name: "Potage de l√©gumes", allergens: [] },
                            { name: "Salade de crudit√©s", allergens: [] },
                            { name: "Yaourt nature", allergens: ["lactose"] }
                        ],
                        saladItems: [
                            { name: "Salade verte aux noix", allergens: ["noix"] },
                            { name: "Salade de tomates", allergens: [] },
                            { name: "Salade de carottes r√¢p√©es", allergens: [] }
                        ],
                        vegetarien: "Risotto aux champignons et parmesan",
                        avis: []
                    }
                };

                // Enregistrer le menu principal
                localStorage.setItem('orif_menu_data', JSON.stringify(menuTest));
                log("Menu principal enregistr√© dans localStorage");

                // Cr√©er l'entr√©e historique
                const historyItem = {
                    id: Date.now(),
                    date: dateString,
                    platName: "Coq au Vin de Demain",
                    platDesc: "Coq au vin traditionnel avec pommes de terre r√¥ties et l√©gumes de saison",
                    platImg: "plat_jour.jpg",
                    platVeg: false,
                    platAllergens: ["sulfites", "lactose"],
                    dessertText: "Tarte aux pommes maison",
                    dessertAllergens: ["gluten", "lactose", "oeufs"],
                    selfItems: [
                        { name: "Potage de l√©gumes", allergens: [] },
                        { name: "Salade de crudit√©s", allergens: [] },
                        { name: "Yaourt nature", allergens: ["lactose"] }
                    ],
                    saladItems: [
                        { name: "Salade verte aux noix", allergens: ["noix"] },
                        { name: "Salade de tomates", allergens: [] },
                        { name: "Salade de carottes r√¢p√©es", allergens: [] }
                    ],
                    vegText: "Risotto aux champignons et parmesan",
                    timestamp: new Date().toISOString()
                };

                // Ajouter √† l'historique
                const history = JSON.parse(localStorage.getItem('orif_menu_history') || '[]');
                const filteredHistory = history.filter(item => item.date !== dateString);
                filteredHistory.unshift(historyItem);
                localStorage.setItem('orif_menu_history', JSON.stringify(filteredHistory));
                
                log("Menu ajout√© √† l'historique (ID: " + historyItem.id + ")");
                log("Historique contient maintenant " + filteredHistory.length + " √©l√©ments");

                const resultDiv = document.getElementById('result-step2');
                resultDiv.innerHTML = `
                    <div class="success">
                        ‚úÖ Menu cr√©√© avec succ√®s pour ${demain.toLocaleDateString('fr-FR')}
                    </div>
                    <div class="menu-preview">
                        <strong>üçΩÔ∏è Plat Principal:</strong> ${menuTest.today.platName}<br>
                        <strong>üìù Description:</strong> ${menuTest.today.platDesc}<br>
                        <strong>üç∞ Dessert:</strong> ${menuTest.today.dessertText}<br>
                        <strong>ü•ó V√©g√©tarien:</strong> ${menuTest.today.vegetarien}
                    </div>
                `;

                // Activer l'√©tape suivante
                document.getElementById('btn-verif').disabled = false;
                
            } catch (e) {
                log("ERREUR √©tape 2: " + e.message);
                document.getElementById('result-step2').innerHTML = '<div class="error">‚ùå Erreur: ' + e.message + '</div>';
            }
        }

        function etape3Verification() {
            log("=== √âTAPE 3: V√âRIFICATION ENREGISTREMENT ===");
            
            try {
                const menuData = JSON.parse(localStorage.getItem('orif_menu_data') || '{}');
                const history = JSON.parse(localStorage.getItem('orif_menu_history') || '[]');
                
                log("Menu data trouv√©: " + (menuData.today ? "OUI" : "NON"));
                log("Historique contient: " + history.length + " √©l√©ments");
                
                const demain = new Date();
                demain.setDate(demain.getDate() + 1);
                const dateString = demain.toISOString().slice(0, 10);
                
                const menuDemain = history.find(item => item.date === dateString);
                log("Menu pour demain trouv√©: " + (menuDemain ? "OUI (ID: " + menuDemain.id + ")" : "NON"));
                
                const resultDiv = document.getElementById('result-step3');
                
                if (menuData.today && menuDemain) {
                    resultDiv.innerHTML = `
                        <div class="success">
                            ‚úÖ V√©rification r√©ussie !<br>
                            ‚úì Menu principal enregistr√©<br>
                            ‚úì Historique mis √† jour<br>
                            ‚úì Menu pour demain (${dateString}) pr√©sent
                        </div>
                    `;
                    
                    // Activer l'√©tape suivante
                    document.getElementById('btn-test-benef').disabled = false;
                    
                } else {
                    resultDiv.innerHTML = '<div class="error">‚ùå Probl√®me de v√©rification</div>';
                }
                
            } catch (e) {
                log("ERREUR √©tape 3: " + e.message);
                document.getElementById('result-step3').innerHTML = '<div class="error">‚ùå Erreur: ' + e.message + '</div>';
            }
        }

        function etape4TestBeneficiaire() {
            log("=== √âTAPE 4: TEST B√âN√âFICIAIRE ===");
            
            try {
                // Connexion b√©n√©ficiaire
                const result = login("ayesh.benef@orif.ch", "0000");
                if (!result) {
                    log("ERREUR: Connexion b√©n√©ficiaire √©chou√©e");
                    return;
                }
                
                log("Connexion b√©n√©ficiaire r√©ussie: " + result.name);
                renderAccountArea();
                
                // Test ajout d'avis
                const avisSuccess = ajouterAvis(5, "Excellent menu pour demain ! J'ai h√¢te de le go√ªter.");
                
                if (avisSuccess) {
                    log("Avis ajout√© avec succ√®s");
                    
                    // V√©rifier les avis
                    const avis = getAvisData();
                    log("Total avis dans le syst√®me: " + avis.length);
                    
                    const resultDiv = document.getElementById('result-step4');
                    resultDiv.innerHTML = `
                        <div class="success">
                            ‚úÖ Test b√©n√©ficiaire r√©ussi !<br>
                            ‚úì Connexion b√©n√©ficiaire OK<br>
                            ‚úì Avis ajout√© avec succ√®s<br>
                            ‚úì Syst√®me complet fonctionnel
                        </div>
                        <div style="margin-top: 1rem;">
                            <strong>üéâ D√âMONSTRATION TERMIN√âE AVEC SUCC√àS !</strong><br>
                            <a href="index.html" class="btn" style="display: inline-block; margin-top: 0.5rem;">Voir le Menu Public</a>
                            <a href="confirmation-menu.html" class="btn" style="display: inline-block; margin-top: 0.5rem;">Page Confirmation</a>
                        </div>
                    `;
                    
                } else {
                    log("ERREUR: √âchec ajout avis");
                    document.getElementById('result-step4').innerHTML = '<div class="error">‚ùå Erreur ajout avis</div>';
                }
                
            } catch (e) {
                log("ERREUR √©tape 4: " + e.message);
                document.getElementById('result-step4').innerHTML = '<div class="error">‚ùå Erreur: ' + e.message + '</div>';
            }
        }
    </script>
    
    <footer style="background: #2c3e50; color: white; text-align: center; padding: 2rem 1rem 1rem; margin-top: 2rem;">
        <p style="margin: 0 0 1rem 0; color: white;">¬© 2025 ORIF ‚Äì Tous droits r√©serv√©s</p>
        <div class="footer-links" style="display: flex; justify-content: center; gap: 2rem; flex-wrap: wrap;">
            <a href="#" style="color: #bdc3c7; text-decoration: none; font-size: 0.9rem;">Mentions l√©gales</a>
            <a href="#" style="color: #bdc3c7; text-decoration: none; font-size: 0.9rem;">Conditions d'utilisation</a>
            <a href="#" style="color: #bdc3c7; text-decoration: none; font-size: 0.9rem;">Politique de confidentialit√©</a>
            <a href="#" style="color: #bdc3c7; text-decoration: none; font-size: 0.9rem;">Accessibilit√©</a>
        </div>
    </footer>
</body>
</html>